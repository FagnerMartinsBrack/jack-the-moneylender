<script src="qunit.js"></script>
<link rel="stylesheet" href="qunit.css">
<div id="qunit"></div>
<script src="dollar.js"></script>
<script>
  function strictEqual({ expected, actual }, assert) {
    assert.strictEqual(actual, expected);
  }

  const interestToPayFor = (loanAmount) => {
    const END_OF_FIRST_RANGE = Money('$2000.00');
    const END_OF_SECOND_RANGE = Money('$5000.00');
    const END_OF_THIRD_RANGE = Money('$10000.00');

    const CENTS_FOR_FIRST_RANGE = Money('$0.00');
    const CENTS_FOR_SECOND_RANGE = Money('$0.09');
    const CENTS_FOR_THIRD_RANGE = Money('$0.14');
    const CENTS_FOR_FOURTH_RANGE = Money('$0.21');

    // TODO Remove specific wording from functions and generalize
    const calculateInterestForGreaterThan2000 = (loanAmount, endOfThisRange, centsForThisRange, centsForPreviousRange) => {
      const dollarsAboveThreshold = loanAmount.minus(endOfThisRange);
      const interestAmount = centsForThisRange.minus(centsForPreviousRange).multipliedBy(dollarsAboveThreshold);
      return interestAmount;
    };

    const calculateInterestForGreaterThan5000 = (loanAmount, endOfThisRange, centsForThisRange, centsForPreviousRange) => {
      const dollarsAboveThreshold = loanAmount.minus(endOfThisRange);
      const interestAmount = centsForThisRange.minus(centsForPreviousRange).multipliedBy(dollarsAboveThreshold);
      return interestAmount;
    };

    // The reason you create the function locally first is that you can see the arguments. The conascence is by position.
    const calculateInterestForGreaterThan10000 = (loanAmount, endOfThisRange, centsForThisRange, centsForPreviousRange) => {
      const dollarsAboveThreshold = loanAmount.minus(endOfThisRange);
      const interestAmount = centsForThisRange.minus(centsForPreviousRange).multipliedBy(dollarsAboveThreshold);
      return interestAmount;
    };

    if (loanAmount.greaterThan(END_OF_FIRST_RANGE) && loanAmount.lessThan(Money('$5001.00'))) { // In the real commits, remember to remove this magic number
      const interestForGreaterThan2000 = calculateInterestForGreaterThan2000(loanAmount, END_OF_FIRST_RANGE, CENTS_FOR_SECOND_RANGE, CENTS_FOR_FIRST_RANGE);
      return interestForGreaterThan2000;
    }

    if (loanAmount.greaterThan(END_OF_SECOND_RANGE) && loanAmount.lessThan(Money('$10001.00'))) {
      let interestAmount = Money('$0.00');

      const interestForGreaterThan2000 = calculateInterestForGreaterThan2000(loanAmount, END_OF_FIRST_RANGE, CENTS_FOR_SECOND_RANGE, CENTS_FOR_FIRST_RANGE);
      interestAmount = interestAmount.plus(interestForGreaterThan2000);

      const interestForGreaterThan5000 = calculateInterestForGreaterThan5000(loanAmount, END_OF_SECOND_RANGE, CENTS_FOR_THIRD_RANGE, CENTS_FOR_SECOND_RANGE);
      interestAmount = interestAmount.plus(interestForGreaterThan5000);

      return interestAmount;
    }

    if (loanAmount.greaterThan(END_OF_THIRD_RANGE)) {
      let interestAmount = Money('$0.00');

      const interestForGreaterThan2000 = calculateInterestForGreaterThan2000(loanAmount, END_OF_FIRST_RANGE, CENTS_FOR_SECOND_RANGE, CENTS_FOR_FIRST_RANGE);
      interestAmount = interestAmount.plus(interestForGreaterThan2000);

      const interestForGreaterThan5000 = calculateInterestForGreaterThan5000(loanAmount, END_OF_SECOND_RANGE, CENTS_FOR_THIRD_RANGE, CENTS_FOR_SECOND_RANGE);
      interestAmount = interestAmount.plus(interestForGreaterThan5000);

      const interestForGreaterThan10000 = calculateInterestForGreaterThan10000(loanAmount, END_OF_THIRD_RANGE, CENTS_FOR_FOURTH_RANGE, CENTS_FOR_THIRD_RANGE);
      interestAmount = interestAmount.plus(interestForGreaterThan10000);

      return interestAmount;
    }

    return CENTS_FOR_FIRST_RANGE;
  };

  QUnit.module('Loans of $2000 and below are interest-free. For example');

  QUnit.test('A loan for $1.00 owes $0 interest', (assert) => {
    strictEqual({ expected: '$0.00', actual: interestToPayFor(Money('$1.00')).toString() }, assert);
  });

  QUnit.test('A loan for $2000.00 owes $0 interest', (assert) => {
    strictEqual({ expected: '$0.00', actual: interestToPayFor(Money('$2000.00')).toString() }, assert);
  });

  QUnit.module('After $2000.00 up to $5000.00, each additional dollar owes $0.09 of interest. For example');

  QUnit.test('A loan of $2001.00 owes $0.09 interest', (assert) => {
    strictEqual({ expected: '$0.09', actual: interestToPayFor(Money('$2001.00')).toString() }, assert);
  });

  QUnit.test('A loan of $2002.00 owes $0.18 interest', (assert) => {
    strictEqual({ expected: '$0.18', actual: interestToPayFor(Money('$2002.00')).toString() }, assert);
  });

  QUnit.test('A loan of $5000 owes $270.00 interest', (assert) => {
    strictEqual({ expected: '$270.00', actual: interestToPayFor(Money('$5000.00')).toString() }, assert);
  });

  QUnit.module('After $5000.00, each additional dollar owes $0.14 of interest. For example');

  QUnit.test('A loan of $5001.00 owes $270.14 interest', (assert) => {
    strictEqual({ expected: '$270.14', actual: interestToPayFor(Money('$5001.00')).toString() }, assert);
  });

  QUnit.test('A loan of $5002.00 owes $270.28 interest', (assert) => {
    strictEqual({ expected: '$270.28', actual: interestToPayFor(Money('$5002.00')).toString() }, assert);
  });

  // 10000 - 5002 = 4998
  // 4998 * 0.14 = 699.72
  // 699.72 + 270.28 = 970
  QUnit.test('A loan of $10000.00 owes $970.00 interest', (assert) => {
    strictEqual({ expected: '$970.00', actual: interestToPayFor(Money('$10000.00')).toString() }, assert);
  });

  QUnit.test('A loan of $10001.00 owes $970.00 interest', (assert) => {
    strictEqual({ expected: '$970.21', actual: interestToPayFor(Money('$10001.00')).toString() }, assert);
  });

  QUnit.test('A loan of $10002.00 owes $970.00 interest', (assert) => {
    strictEqual({ expected: '$970.42', actual: interestToPayFor(Money('$10002.00')).toString() }, assert);
  });

</script>